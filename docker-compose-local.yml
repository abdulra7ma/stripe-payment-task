version: '3.7'
services:
  database:
    environment:
      POSTGRES_DB: payment_task_db
      POSTGRES_PASSWORD: payment_task_db_password_1
    image: postgres:14.1
    ports:
      - 5432:5432
    restart: always
    volumes:
      - pg_data:/var/lib/postgresql/data:rw
  web:
    build: .
    command: sh -c "python manage.py migrate && python manage.py loaddata fixtures.json && python manage.py runserver 0.0.0.0:8000"
    volumes:
      - .:/home/payment_task_user/code/
    ports:
      - "8000:8000"
    environment:
      - DEBUG=True
      - POSTGRES_DATABASE_NAME=payment_task_db
      - POSTGRES_DATABASE_USER=postgres
      - POSTGRES_DATABASE_PASSWORD=payment_task_db_password_1
      - POSTGRES_DATABASE_HOST=database
      - POSTGRES_DATABASE_PORT=5432
      - STRIPE_PUBLISHABLE_KEY=pk_test_51LjLWxJ6CVNUL4NF0DL9rWVRFFmn3w8kE952BtPMNZQfzyL2RvmkRpuO8tkwRMTmAT2Wr08IVOwQHCaGJfCGhRQG00zal25VHT
      - STRIPE_SECRET_KEY=sk_test_51LjLWxJ6CVNUL4NFvXKjiEIMgbd5zr6x7Xwbq8lCamlXNtpTCwtO3WiM631dkq6ejyiHN1OuZApjuverFap39g8L00utff5kRf
      - STRIPE_SUCCESS_PAYMENT_CARD=4242424242424242
      - STRIPE_SUCCESS_FAILED_CARD=4000000000009995

    depends_on:
      - database
volumes:
  pg_data: {}